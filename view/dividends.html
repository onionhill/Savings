<html>
    <head>
        <script src="/public/js/jquery-3.6.0.min.js"></script>    
        <!-- Load d3.js and c3.js -->
        <link href="/public/css/c3.min.css" rel="stylesheet">

        <script src="/public/js/d3.v5.min.js" charset="utf-8"></script>
        <script src="/public/js/c3.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
        <script type="text/javascript" src="/public/js/jquery.tablesorter.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">

            <div class="collapse navbar-collapse" id="navbarNavDropdown">
              <ul class="navbar-nav">
                <li class="nav-item active">
                  <a class="nav-link" href="/">Portfolio </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/dividends">Dividens</a>
                </li>
              </ul>
            </div>
          </nav>
        <main>
            <div class="container">
                <h1 style="text-align:center">Utbytte oversikt</h1>  
                <br><br>
                    <div id="div_chart"></div>

                <br><br>
                <div id="dividends_overview"></div>
            </div>
        </main>
    </body>

    <script src="/public/js/portfolio_view_data.js"></script>    

<script>
    $(async function(){
        initPortFolio();
   
        // Videre planer for denne siden:
        /*
            Alle selskap som betaler utbytte skal listes nedover. Bortover skal det vises m√•ned
            For hver rad og kolonne skal det lages sum
                            Jan Feb Mars
            Apple   1 0 0  1 
            MS      0 1 1  2
            Amazon  1 1 1   3
                    2 2 2  6
        */

    });
    function create_dividends_overview(){
        const dividend_table =  $('<table class="table"/>').append(
            $('<thead>').append(
                $('<tr>').append(
                    '<th>Dato</th>',
                    '<th>Ticket</th>',
                    '<th>Verdi</th>'
                )
            )  
        );
        
        let dividend_array = [];
        Object.keys(dividends).forEach((ticket) => {
            let dividend = dividends[ticket].map(object => {
                return {...object, ticket: ticket};
            });
            dividend_array.push(...dividend);
        });

        const sorted_elements = dividend_array.sort((a,b) => {
            return new Date(b.DATE) - new Date(a.DATE)
        });

        const dividends_table_body = $('<tbody>');
        let total_dividend = 0;
        sorted_elements.forEach( (item) => {
            total_dividend += convert_currency(item.CURRENCY, item.VALUE);
            const tr = $('<tr>').append(
                `<td>${convert_date(item.DATE)}</td>`,  //Dato
                $('<td>').append(item.ticket ), //Ticket
                $('<td>').append(format_number( convert_currency(item.CURRENCY, item.VALUE), false ) ), //Verdi
            );
        
            dividends_table_body.append(tr);
        });
        dividends_table_body.prepend(`<tr><td>TOTALT</td><td>&nbsp</td><td>${total_dividend}</td></tr>`);
        dividend_table.append(dividends_table_body);

        $('#dividends_overview').append(dividend_table);

        create_dividends_chart(sorted_elements);
    }

    function create_dividends_chart(elements){
        // Year -> [0
        let month_data = {
            2021: [ ...Array(12).keys() ].map(() => 0),
            2022: [ ...Array(12).keys() ].map(() => 0),
        }

        elements.forEach( (item) => {
            const date = new Date(item.DATE);
            month_data[date.getFullYear()][date.getMonth()] += convert_currency(item.CURRENCY, item.VALUE);
            month_data[date.getFullYear()][date.getMonth()] = Math.round(month_data[date.getFullYear()][date.getMonth()] * 100) / 100;
        });


        var chart = c3.generate({
            bindto: '#div_chart',
            data: {
                json: month_data,
                type: 'bar'
            },
            bar: {
                width: {
                    ratio: 0.5 // this makes bar width 50% of length between ticks
                }
                // or
                //width: 100 // this makes bar width 100px
            },axis: {
                x: {
                    type: 'category',
                    categories: ['Januar', 'Februar', 'Mars', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Desember']
                }
            }
        });
        console.log(month_data);
    }
    </script>
</html>
